{% extends "dashboard.html" %}

{% block content %}
<div class="container-fluid py-4">

    <div class="row mb-4 animate__animated animate__fadeIn">
        <div class="col-12">
            <div class="p-5 rounded-4 shadow-lg border-0 position-relative overflow-hidden text-white"
                 style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);">
                <div class="position-relative z-index-1">
                    <div class="d-flex align-items-center mb-3">
                        <span class="badge bg-white bg-opacity-20 rounded-pill px-3 py-2 fw-bold shadow-sm">
                            <i class="fas fa-calendar-alt me-2"></i> {% now "d F, Y" %}
                        </span>
                    </div>
                    <h1 class="display-5 fw-800 mb-2">–î–æ–±—Ä—ã–π –¥–µ–Ω—å, {{ teacher.fio|default:user.username }}! üëã</h1>
                    <p class="opacity-75 mb-0 fs-5 w-75">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏–µ–º. –°–µ–≥–æ–¥–Ω—è —É –≤–∞—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø: <strong>{{ groups.count }}</strong>.</p>
                </div>
                <i class="fas fa-graduation-cap position-absolute"
                   style="right: -40px; bottom: -40px; font-size: 18rem; opacity: 0.15; transform: rotate(-15deg);"></i>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5 animate__animated animate__fadeInUp">
        <div class="col-xl-4 col-md-6">
            <div class="stat-card-premium bg-white p-4 rounded-4 shadow-sm border-0 h-100 transition-hover">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div class="stat-icon bg-primary-light text-primary">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <span class="badge badge-success-light">–ê–∫—Ç–∏–≤–¥“Ø“Ø</span>
                </div>
                <h6 class="text-muted small fw-bold text-uppercase mb-1 ls-1">–ú–æ–∏ —É—á–µ–Ω–∏–∫–∏</h6>
                <h2 class="fw-800 mb-0">{{ total_students|default:"0" }}</h2>
                <div class="mt-4 border-top pt-3">
                    <a href="{% url 'teacher_students' %}" class="text-primary text-decoration-none small fw-bold">
                        –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤ <i class="fas fa-arrow-right ms-2 animate-arrow"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="stat-card-premium bg-white p-4 rounded-4 shadow-sm border-0 h-100 transition-hover">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div class="stat-icon bg-success-light text-success">
                        <i class="fas fa-award"></i>
                    </div>
                    <div class="text-muted small fw-bold">–í—Å–µ–≥–æ</div>
                </div>
                <h6 class="text-muted small fw-bold text-uppercase mb-1 ls-1">–û–±—â–∏–µ –æ—á–∫–∏</h6>
                <h2 class="fw-800 mb-0">{{ total_points|default:"0" }}</h2>
                <div class="mt-4 border-top pt-3">
                    <span class="text-muted small">–¢–µ–º–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: <span class="text-success fw-bold">–í—ã—Å–æ–∫–∏–π</span></span>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="stat-card-premium bg-white p-4 rounded-4 shadow-sm border-0 h-100 transition-hover">
                <div class="d-flex justify-content-between align-items-start mb-4">
                    <div class="stat-icon bg-warning-light text-warning">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <span class="badge bg-light text-dark rounded-pill border">–¢–µ–∫—É—â–∏–π —Å–µ–º–µ—Å—Ç—Ä</span>
                </div>
                <h6 class="text-muted small fw-bold text-uppercase mb-1 ls-1">–ì—Ä—É–ø–ø—ã</h6>
                <h2 class="fw-800 mb-0">{{ groups.count|default:"0" }}</h2>
                <div class="mt-4 border-top pt-3 text-muted small">
                    <i class="fas fa-info-circle me-1"></i> –ù–∞–∂–º–∏—Ç–µ "–ñ—É—Ä–Ω–∞–ª" –Ω–∏–∂–µ
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
        <div class="card-header bg-white border-0 py-4 px-4">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-4">
                <div>
                    <h4 class="fw-800 m-0 text-dark">–ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã</h4>
                    <p class="text-muted small mb-0 mt-1">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∂—É—Ä–Ω–∞–ª–æ–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.</p>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="search-box position-relative">
                        <i class="fas fa-search position-absolute text-muted" style="left: 15px; top: 12px;"></i>
                        <input type="text" class="form-control rounded-pill ps-5 border-0 bg-light-subtle" placeholder="–ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø—ã..." style="height: 40px; width: 220px;">
                    </div>
                    <a href="{% url 'teacher_students' %}" class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm h-40 d-flex align-items-center">
                        <i class="fas fa-users me-2"></i> –£—á–µ–Ω–∏–∫–∏
                    </a>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr class="text-muted small fw-bold ls-1">
                        <th class="ps-4 py-3">–ì–†–£–ü–ü–ê</th>
                        <th>–ö–£–†–° / –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï</th>
                        <th class="text-center">–°–¢–£–î–ï–ù–¢–´</th>
                        <th class="text-center" style="min-width: 150px;">–ü–†–û–ì–†–ï–°–°</th>
                        <th class="text-end pe-4">–î–ï–ô–°–¢–í–ò–Ø</th>
                    </tr>
                </thead>
                <tbody class="border-top-0">
                    {% for group in groups %}
                    <tr>
                        <td class="ps-4 py-4">
                            <div class="d-flex align-items-center">
                                <div class="avatar-letter me-3">
                                    {{ group.name|slice:":1"|upper }}
                                </div>
                                <div>
                                    <span class="fw-bold text-dark d-block">{{ group.name }}</span>
                                    <span class="text-muted x-small">ID: {{ group.id }}</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="text-muted small d-flex align-items-center">
                                <i class="fas fa-book-open me-2 text-primary opacity-50"></i>
                                {{ group.subject.name|default:"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" }}
                            </span>
                        </td>
                        <td class="text-center">
                            <span class="badge badge-primary-light">
                                <i class="fas fa-users-viewfinder me-1"></i> {{ group.liststudent_set.count }}
                            </span>
                        </td>
                        <td class="text-center px-4">
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress flex-grow-1" style="height: 8px; border-radius: 10px;">
                                    <div class="progress-bar bg-primary rounded-pill" role="progressbar" style="width: 75%;"></div>
                                </div>
                                <span class="fw-bold small text-muted">75%</span>
                            </div>
                        </td>
                        <td class="text-end pe-4">
                            <div class="d-flex justify-content-end gap-2">
                                <a href="{% url 'group_journal' group.id %}" class="btn btn-dark btn-sm rounded-pill px-3 fw-bold">
                                    <i class="fas fa-clipboard-list me-1"></i> –ñ—É—Ä–Ω–∞–ª
                                </a>
                                <button class="btn btn-light btn-sm rounded-circle shadow-sm">
                                    <i class="fas fa-ellipsis-v text-muted"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" width="80" class="opacity-20 mb-3">
                            <p class="text-muted fw-bold">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');

    /* Typography & Utilities */
    .fw-800 { font-weight: 800; }
    .ls-1 { letter-spacing: 0.5px; }
    .x-small { font-size: 0.75rem; }
    .h-40 { height: 40px; }

    /* Stat Cards Custom UI */
    .stat-card-premium { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .transition-hover:hover { transform: translateY(-7px); box-shadow: 0 15px 35px rgba(0,0,0,0.08) !important; }

    .stat-icon {
        width: 54px; height: 54px; border-radius: 14px;
        display: flex; align-items: center; justify-content: center; font-size: 1.4rem;
    }

    .avatar-letter {
        width: 48px; height: 48px; border-radius: 12px;
        background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
        color: #4f46e5; display: flex; align-items: center; justify-content: center;
        font-weight: 800; font-size: 1.2rem;
    }

    /* Colors */
    .bg-primary-light { background: #eef2ff; }
    .bg-success-light { background: #ecfdf5; }
    .bg-warning-light { background: #fffbeb; }
    .bg-light-subtle { background: #f1f5f9; }

    .badge-primary-light { background: #eef2ff; color: #4f46e5; border-radius: 10px; padding: 6px 12px; font-weight: 700; }
    .badge-success-light { background: #d1fae5; color: #059669; border-radius: 10px; padding: 4px 10px; font-weight: 700; }

    /* Animations */
    .animate-arrow { transition: transform 0.2s; }
    .transition-hover:hover .animate-arrow { transform: translateX(5px); }
</style>
{% endblock %}